<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="layout(content)">

<head th:fragment="header">
    <meta charset="UTF-8">
    <title>Opizza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" th:href="@{/img/favicon.ico}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body class="flex flex-col min-h-screen">
<nav class="text-white shadow-lg bg-white">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <a th:href="@{/}" class="flex items-center text-2xl font-bold text-gray-600 gap-4">
            <img th:src="@{/img/logo.png}" alt="Logo" width="50"> Opizza
        </a>

        <div class="hidden lg:flex items-center space-x-6">
            <div sec:authorize="hasRole('ADMIN')" class="flex items-center space-x-2 border-r pr-2 border-gray-200">
                <a th:href="@{/admin/orders}" class="text-gray-600 hover:text-blue-600 font-small flex items-center gap-1">
                    Objednávky
                    <span id="order-badge" class="order-badge-count hidden bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full blink-notification">0</span>
                </a>
                <a th:href="@{/admin/products}" class="text-gray-600 hover:text-blue-600 font-small">Menu</a>
                <a th:href="@{/admin/categories}" class="text-gray-600 hover:text-blue-600 font-small">Kategórie</a>
                <a th:href="@{/admin/tags}" class="text-gray-600 hover:text-blue-600 font-small">Tagy</a>
                <a th:href="@{/admin/ingredients}" class="text-gray-600 hover:text-blue-600 font-small">Ingrediencie</a>
                <a th:href="@{/admin/sizes}" class="text-gray-600 font-small">Velkosti</a>
                <a th:href="@{/admin/users}" class="text-gray-600 font-small">Users</a>
            </div>

            <div sec:authorize="hasRole('COOK')" class="flex items-center space-x-2 border-r pr-2 border-gray-200">
                <a th:href="@{/admin/orders}" class="text-gray-600 hover:text-blue-600 font-small flex items-center gap-1">
                    Objednávky
                    <span id="order-badge" class="order-badge-count hidden bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full blink-notification">0</span>
                </a>
                <a th:href="@{/admin/ingredients}" class="text-gray-600 hover:text-blue-600 font-small flex items-center gap-1">Ingrediencie</a>
            </div>

            <div sec:authorize="hasRole('COURIER')" class="flex items-center space-x-2 border-r pr-2 border-gray-200">
                <a th:href="@{/admin/orders}" class="text-gray-600 hover:text-blue-600 font-small flex items-center gap-1">
                    Objednávky
                    <span id="order-badge" class="order-badge-count hidden bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full blink-notification">0</span>
                </a>
            </div>

            <form th:action="@{/}" method="get" class="relative">
                <input type="text" name="search" placeholder="Hľadať pizzu"
                       class="rounded-lg px-4 py-1 w-64 border border-gray-300 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600">
                <button type="submit" class="absolute right-3 top-1">
                    <i class="fa fa-search text-blue-600"></i>
                </button>
            </form>

            <a th:href="@{/cart}" class="text-blue-600"><i class="fa fa-shopping-cart"></i> Košík</a>

            <div sec:authorize="isAnonymous()" class="text-blue-600">
                <a th:href="@{/auth/login}">Prihlásiť</a>
            </div>

            <div sec:authorize="isAuthenticated()" class="flex items-center space-x-4">
                <a th:href="@{/orders/history}" class="text-gray-600">
                    <span>História</span>
                </a>
                <a th:href="@{/profile}" class="font-semibold text-gray-600">
                    <span th:if="${#authentication.principal instanceof T(sk.ukf.opizza.config.UserPrincipal)}" th:text="${#authentication.principal.firstName}">Meno</span>
                </a>
                <form th:action="@{/logout}" method="post" class="inline">
                    <button type="submit" class="text-sm px-3 py-1 rounded-full text-blue-600">Odhlásiť</button>
                </form>
            </div>
        </div>

        <button id="menu-toggle" class="lg:hidden text-gray-600 focus:outline-none">
            <i class="fa fa-bars text-2xl"></i>
        </button>
    </div>

    <div id="mobile-menu" class="hidden lg:hidden bg-gray-50 border-t border-gray-200 px-4 py-4 space-y-4 text-center">
        <div sec:authorize="hasRole('ADMIN')" class="flex flex-col space-y-2 border-b pb-4">
            <span class="text-xs font-bold text-gray-400 uppercase">Administrácia</span>
            <a th:href="@{/admin/orders}" class="text-gray-600 font-small flex items-center justify-center gap-2">
                Objednávky
                <span id="order-badge-mobile" class="hidden bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full blink-notification">0</span>
            </a>
            <a th:href="@{/admin/products}" class="text-gray-600 font-small">Menu</a>
            <a th:href="@{/admin/categories}" class="text-gray-600 font-small">Kategórie</a>
            <a th:href="@{/admin/tags}" class="text-gray-600 font-small">Tagy</a>
            <a th:href="@{/admin/ingredients}" class="text-gray-600 font-small">Ingrediencie</a>
            <a th:href="@{/admin/sizes}" class="text-gray-600 font-small">Velkosti</a>
            <a th:href="@{/admin/users}" class="text-gray-600 font-small">Users</a>
        </div>

        <div sec:authorize="hasRole('COOK')" class="flex flex-col space-y-2 border-b pb-4">
            <a th:href="@{/admin/orders}" class="text-gray-600 font-small flex items-center justify-center gap-2">
                Objednávky
                <span id="order-badge-mobile" class="hidden bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full blink-notification">0</span>
            </a>
            <a th:href="@{/admin/ingredients}" class="text-gray-600 hover:text-blue-600 font-small flex items-center gap-1">Ingrediencie</a>
        </div>

        <div sec:authorize="hasRole('COURIER')" class="flex flex-col space-y-2 border-b pb-4">
            <a th:href="@{/admin/orders}" class="text-gray-600 font-small flex items-center justify-center gap-2">
                Objednávky
                <span id="order-badge-mobile" class="hidden bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full blink-notification">0</span>
            </a>
        </div>

        <form th:action="@{/}" method="get" class="relative">
            <input type="text" name="search" placeholder="Hľadať pizzu"
                   class="w-full rounded-lg px-4 py-2 border border-gray-300 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600">
            <button type="submit" class="absolute right-3 top-2">
                <i class="fa fa-search text-blue-600"></i>
            </button>
        </form>

        <div class="flex flex-col space-y-3 pt-2">
            <a th:href="@{/cart}" class="text-blue-600"><i class="fa fa-shopping-cart"></i> Košík</a>

            <div sec:authorize="isAnonymous()">
                <a th:href="@{/auth/login}" class="text-blue-600">Prihlásiť sa</a>
            </div>

            <div sec:authorize="isAuthenticated()" class="flex flex-col space-y-3">
                <a th:href="@{/orders/history}" class="text-gray-600">
                    História
                </a>
                <a th:href="@{/profile}" class="font-semibold text-gray-600">
                    Profil (<span th:text="${#authentication.principal.firstName}">Meno</span>)
                </a>
                <form th:action="@{/logout}" method="post">
                    <button type="submit" class="text-blue-600 text-left">Odhlásiť sa</button>
                </form>
            </div>
        </div>
    </div>
</nav>

<main class="container mx-auto px-4 py-8 flex-grow">
    <div th:replace="${content}"></div>
</main>

<footer class="bg-gray-800 text-white py-6 mt-auto">
    <div class="container mx-auto px-4 text-center">
        <p>2025 - <span th:text="${#temporals.format(#temporals.createNow(), 'yyyy')}"></span> &copy; Opizza</p>
    </div>
</footer>

<script th:src="@{/js/scripts.js}" defer></script>
<script th:src="@{/js/admin.js}" defer sec:authorize="hasRole('ADMIN')"></script>
<script th:src="@{/js/admin.js}" defer sec:authorize="hasRole('COOK')"></script>
<script th:src="@{/js/admin.js}" defer sec:authorize="hasRole('COURIER')"></script>

</body>
</html>